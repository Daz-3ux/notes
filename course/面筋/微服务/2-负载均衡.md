## 负载均衡
- 本质上就是一个问题--`我该把请求发给哪个服务端`
- 静态负载均衡算法
  - 靠的是统计学上的"最合适"
- 动态负载均衡算法
  - 实时检测

## 轮询和加权轮询
- "排排坐分果果"
- 根据节点的实际处理能力进行"加权"
- 平滑的加权轮询算法
  - 一个节点每次被挑选后,它的 currentWeight 就会下降,下一次就不会选中它

## 随机和加权随机
- 靠随机数之类的
- 相比于轮询,可控性会差一些
  - 轮询算法和随机算法，从统计学角度来看，最终效果是一样的。但是轮询算法天然的就会比随机算法更平滑，可以避免连读多次请求打到一个节点上

## 哈希和一致性哈希
- 哈希算法的选取会严重影响负载均衡的效果
  - 所以需要一致性哈希
- `一致性哈希`
  - 哈希环

## 最少连接数
- 选连接数最少的服务端
  - 缺陷在于连接数并不能代表节点的实际负载
  - 尤其是连接多路复用的情况下

## 最少活跃数
- 用当前活跃请求数来代表服务端节点的负载
  - 活跃请求:已经接受但还没返回的请求
  - 也不能真正代表读物理节点的负载
    - 只有一个活跃的,但是是超大请求

## 最快相应算法
- 比上面两个好一些
- 使用综合响应时间代表服务端的负载
  - 综合性指标

## 以上三个算法都是客户端采集数据,如何避免不同的客户端就可能采集到不同的数据
![](https://static001.geekbang.org/resource/image/a2/72/a297920cde1278deb9f8f8b72439bf72.png?wh=2256x1364)
1. 服务端在返回响应的时候顺便把服务端上的一些信息一并返回
2. 从观测平台上查询
  - Prometheus
- 不过目前业界很少用这种复杂的负载均衡算法，也因此几乎所有的微服务框架都没有服务端上报指标到客户端的机制
