## 限流
- 解决异常突发流量打崩系统的问题
- 难点: 限流需要确定一个流量阈值，这个阈值该怎么算？

## 算法
- 静态
  - 令牌桶
    - 不是绝对均匀
    - 但可以应对突发小流量
    - 令牌桶本身允许积攒一部分令牌，所以如果有偶发的突发流量，那么这一部分请求也能得到正常处理。但是要小心令牌桶的容量，不能设置太大。不然积攒的令牌太多的话就起不到限流效果了。例如容量设置为 1000，那么要是积攒了 1000 个令牌之后真的突然来了 1000 个请求，它们都能拿到令牌，那么系统可能撑不住这突如其来的 1000 个请求
  - 漏桶
    - 绝对均匀
  - 固定窗口
    - 一个固定时间段内只允许执行固定数量请求
  - 滑动窗口
    - 逐步变大
- 动态
-  BBR 算法

- 限流是为了保证系统可用性，防止系统因为流量过大而崩溃的一种服务治理手段。从算法上来说，有令牌桶、漏桶、固定窗口和滑动窗口算法。还有动态限流算法，或者说自适应限流算法，比较有名的就是参考了 TCP 拥塞控制算法 BBR 衍生出来的算法，比如说 B 站开源的 Kratos 框架就有一个实现。这些算法之间比较重要的一个区别是能否处理小规模的突发流量。
- 触发限流之后，具体的措施也可以非常灵活。被限流的请求可以同步阻塞一段时间，也可以考虑同步转异步。如果负载均衡算法灵活的话，也可以做一些调整，减少发到该节点的概率。

## 请求大小
- 所以如果面试官问到为什么使用了限流，系统还是有可能崩溃，或者你在负载均衡里面聊到了请求大小的问题，都可以这样来回答，关键词是请求大小

## 计算阈值
- 看服务的观测数据、压测、借鉴、手动计算