# (上-28) 详述进程创建和程序执行

## 进程记账
- 打开进程记账功能后，内核会在每个进程终止时将一条记账信息写入**系统级的进程记账文件**
- Linux系统的记账功能属于是可选内核组件

### 打开和关闭进程记账功能
- 特权进程可利用系统调用acct()来打开和关闭进程记账功能
- 一般是将此命令封装到系统启动脚本，在每次系统重启时开启进程记账功能
```c
#define _BSD_SOURCE
#include<unistd.h>

int acct(const char *acctfile);
```

### 进程账单记录
- acct结构定义于头文件<sys/acct.h>中
- 记录的排序是按照进程的终止时间(并非写入记录)，而非启动时间
- 向记账文件中写入信息可能会加速对磁盘空间的消耗，可使用以下方式对记账行为加以控制
    - 高水位，低水位，频率
    - 若开启进程记账特性且磁盘空间低于**低水位**，则暂停记账
    - 若磁盘空间升至**高水位**水平以上，则恢复记账
    - 频率值规定了两次检查空闲磁盘占比之间的**间隔时间**

### 系统记账文件格式（版本3）
- 备选格式
- 若需使用，需在编译内核前打开内核配置选项CONFIG_BSD_PROCESS_ACCT_V3

## 系统调用clone()
- Linux特有
- 在进程创建期间对步骤的控制更精准
- 主要用于线程库的实现
- 有损于可移植性，应避免在应用程序中直接使用
```c
#define _GUN_SOURCE
#include<sched.h>

int clone(int (*func)(void*),void *child_stack, int flags, void *func_arg, .../*pid_t *ptid,struct user_desc *tls,pid_t *ctid*/);
```
- return process ID of child on success,or -1 on error

##  进程的创建速度
- fork()：进程所占内存越大，耗时越久
- vfork()：进程所占内存大小，影响不大，因为并未像fork一样复制页表
- clone()：进程所占内存大小，影响不大，速度最快
- 尽管vfork()快于fork(),但是较之于子进程随后调用exec()所消耗的时间，二者间的时间差异也就无所谓了

## exec()和fork()对进程属性的影响
进程有很多属性，这存在两个问题：

1. 进程执行exec时，进程属性如何变化，哪些属性会得以保存？
2. 进程执行fork时，进程属性如何变化，哪些属性会得到继承？
