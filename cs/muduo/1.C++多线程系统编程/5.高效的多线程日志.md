# 高效的多线程日志
- 日志(logging)的意义
  - 诊断日志
  - 交易日志
- 在服务器编程中,日志是必不可少的,在生产环境中要做到"Log Everything All The Time"
- 对于关键进程,要记录
  - 收到的每条内部消息的 id
  - 收到的每条外部消息的全文
  - 发出的每条消息的全文,每条消息都有全局唯一的 id
  - 关键内部状态的变更
  - etc...

## WTF
- `SIGUSR1`
  - C++父子进程使用SIGUSR1和SIGUSR2进行通信

## 5.1 功能需求

## 5.2 性能需求

## 5.3 多线程异步日志
- 多线程程序的每个进程最好都只写一个日志文件
  - `异步日志`:用一个背景线程负责收集日志消息,并写入日志文件,其他业务线程只管往这个"日志"线程发送日志消息
  - 采用`双缓冲技术`
    - 有两块 `buffer`:A+B
    - A 负责在前端收消息
    - B 负责在后端将数据写入文件
    - A 满后或者定时器时间满后,交换 A 与 B
    - 相当于批处理:减少了线程唤醒的频率,降低了开销

## 5.4 其他方案
