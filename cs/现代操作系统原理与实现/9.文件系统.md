# 9.1 基于 inode 的文件系统

## 9.1.1 inode与文件
- index node: 索引节点

## 9.1.2 文件名与目录
- 文件名不是文件的元数据,文件名存放于`目录`
- **目录是一种特殊类型的文件**,记录了从文件名到 inode 号的映射
  - 常规的文件保存用户数据
  - 目录保存特殊结构:`目录项`
    - 每个目录项代表一条文件信息,记录了文件的文件名及其对应的 inode 号
  - 目录的大小不取决于目录中文件的大小,而是取决于文件的数量以及文件名的长度

![](https://i.imgur.com/bsbvtmH.png)
![](https://i.imgur.com/QgxtnZ0.png)

## 9.1.3 硬链接与符号链接
### 硬链接
- `ln file link`可为文件file创建另一个名字link
- link就是file的硬链接
- file与link无任何区别,对任一的读写都会影响文件元数据
- 文件系统在inode中记录了一个`链接数(nlink)`

### 符号链接
- `symbolic link` / `soft link`
- `ln -s file slink`
- 符号链接保存的是一个`字符串`
  - 表示文件路径
  - 对应的文件为`目标文件`

### 硬链接与符号链接的比较
- 都允许应用程序使用一个新的路径访问目标文件
  - 符号链接通过解析路径寻找文件
  - 硬链接通过解析目录项寻找 inode 访问目标文件
- 符号链接拥有自己的元数据,删除符号链接不会影响目标文件
- 符号链接中用户可随意存放目标路径,即使目标文件不存在
- 符号链接不受文件系统边界限制,在一个文件系统中,可以创建一个指向其他文件系统的符号链接

- 硬链接的目标文件不能为目录

## 9.1.4 存储布局
![](https://i.imgur.com/9IWCHdK.png)
- `超级块`: 文件系统中必不可少的结构
  - 记录了整个文件系统的`全局元数据`
  - 魔法数字: 超级块之中的重要元数据

# 9.2 虚拟文件系统
- Virtual FIle System: `VFS`
- VFS管理并调用多种文件系统

## 9.2.1 面向文件系统的接口
### VFS定义的内存数据结构
- VFS中的超级块
  - 保存文件系统元数据
  - 每个挂载的文件系统实例均在内存中维护了一个 VFS 超级块结构
  - VFS 的超级块还预留了一个指针:指向(如果一个文件系统有的)特有消息
- VFS 中的 inode
  - VFS 维护了一个 inode 缓存(icache):为了快速定位和使用 inode
- VFS 中的文件数据管理
  - 使用基数树(radix tree)表示一个文件的数据
- VFS 中的目录项
  - 在内存中保存文件名和目标 inode 号的结构
  - 存在目录项缓存(dcache)

### VFS定义的文件系统方法
- Linux 中的 VFS 以`函数指针`的方式定义了文件系统应提供的方法

## 9.2.2 面向应用程序的接口
### 文件描述符
- 整数,由 VFS 维护
  - 应用程序使用`文件路径`换取`文件描述符`,此后使用文件描述符对该文件进行其他操作
  - 文件描述符使 VFS 无须每次都进行路径解析和各种检查操作,一定程度提高了效率

## 9.2.3 页缓存,直接I/O与内存映射

## 9.2.4 多种文件系统的组织和管理

## 9.2.5 伪文件系统

# 9.3 其他文件系统

## 9.3.1 FAT文件系统

## 9.3.2 NTFS

## 9.3.3 FUSE与用户态文件系统

