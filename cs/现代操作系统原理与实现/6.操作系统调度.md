# 计算机调度简介
- 体现在计算机的方方面面

## 操作系统调度
- 详细讲解 `任务调度`

- `线程`是调度器的调度对象，Linux常用`任务`来描述线程

- 调度器一般通过维护`运行队列`「run queue」的方式来管理任务

## 调度指标
- 常用调度指标：
  - 性能指标
    - 吞吐量
    - 周转时间
    - 响应时间
  - 非性能指标
    - 公平性
    - 资源利用率
  - 特有需求
    - 实时任务的实时性
    - 终端设备的消耗

- 批处理任务：
  - 调度指标为使吞吐量尽可能高，周转时间尽可能短
- 交互式任务
  - 确保响应时间足够短
- 实时任务
  - 满足实时性
- 移动终端
  - 降低功耗
- ...

- 设计调度器的调度指标的主要困难
  - 调度指标具有多样性
  - 调度可参考的信息有限
  - 任务间的复杂交互
  - 诸多方面存在权衡
    - 调度开销与调度效果
    - 优先级与公平性
    - 性能与能耗

# 调度机制

## 长期,中期与短期调度
- 进程根据职责不同,将调度分为`长期,中期和短期`

- 长期调度:
  - 限制系统中真正被短期调度管理的进程数量
- 短期调度:
  - 做出实际调度决策
- 中期调度:
  - 负责协调内存资源
  - 换页机制的一部分
![](https://i.imgur.com/abZs5r3.png)

## 任务调度总览
- `长期调度`触发间隔时间长,粗粒度的决定是否应将一个新的进程纳入调度管理,负责增加系统中可被调度的进程的数量
- `中期调度`的触发相对频繁,它辅助换页机制,负责限制系统中可被调度的进程的数量
- `短期调度`触发最频繁,细粒度地调度进程的执行,做出相应的调度决策

![](https://i.imgur.com/qYyNZxT.png)

# 单核调度策略
- 每个任务都有自己的`到达时间`和`运行时间`
  - 到达时间:表示该任务何时被发起并处于预备状态
  - 运行时间:任务从开始执行到结束总共花费的时间

## 经典调度
- `先到先得`
  - First Come First Served : FCFS
  - `非抢占式调度`
  - 先进先出(FIFO)
  - 弊端:
    - 在长短任务混合的场景下对短任务不友好
    - 对I/O密集型任务不友好

- `最短任务优先`
  - Short Job First : SJF
  - `非抢占式调度`
  - 选出运行时间最短的任务执行
  - 弊端:
    - 必须预知任务的运行时间
    - 其表现严重依赖于任务到达时间点

- `最短完成时间任务有限`
  - Short Time-to-Completion First : STCF
  - `抢占式调度`
  - 弊端:
    - 长时间饥饿
      - 长任务不断被短任务打断,总是处于饥饿中

- `时间片轮换`
  - Round Robin : `RR`
  - 关键问题是处理时间片大小选取
  - 过小的
  - 弊端
    - 在任务运行时间相似的场景下平均周转时间高

## 优先级调度
- 引入`优先级`概念 (priority)

- `多级队列`
  - Multi-Level Queue : MLQ
  - 适合`静态`的应用场景
  - 弊端:
    - 低优先级任务饥饿
    - 优先级反转
      - 解决方案:优先级继承

- `多级反馈队列`
  - Multi-Level Feedback Queue : MLFQ
  - 实现了优先级的动态设置:
    - 短任务拥有更高的优先级
    - 低优先级的任务采用更长的时间片
    - 定时地将所有任务的优先级提升至最高

## 公平共享调度
- 引入`份额`概念 (share)
  - 支持`层级化`的分配方式

- `彩票调度`
  - **彩排转让**
  - **彩票货币**
  - **彩票通胀**

- `步幅调度`
  - 采用确定性的方式调度任务,核心概念为`步幅`(stride)
  - 任务的`份额之比`对应了任务的`步幅的倒数之比`
  - 

## 实时调度
- 实时任务可分为两类
  - 硬实时任务
    - hard real-time task
    - 超时的话结果不可接受
  - 软实时任务
    - soft real-time task
    - 超时的话结果可接受
  - 周期任务
  - 偶发任务
  - 非周期任务
  - 速率单调
  - 最早截止时间优先

# 多核调度策略

## 负载分担



## 协同调度

## 两级调度

## 能耗感知调度

# 调度机制进阶

## 处理器亲和性

## 调度策略设置

# 现代调度器

## Linux调度器

## macOS/iOS调度器

